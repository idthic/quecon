

2020-09-05

* slurm の標準出力、標準エラー出力は一体どうなっているのか

  既定では slurm-*.out という名前のファイルが一個作られるだけである。
  一方で sbatch のオプションでは -e と -o でそれぞれ別々に指定できる。

  ? 既定では標準エラーは何処に行くのか
    両方とも slurm-*.out に合流して出力される。

  ? -e と -o を指定した時に slurm-*.out はどうなるのか。
    作られない。

  ? -e だけまたは -o だけ指定するとどうなるのか
    -o だけ指定すると両方ともにそこに出力され、slurm-*.out は作成されない。
    -e だけ指定すると標準エラーだけそこに出力され、
    標準出力は依然として slurm-*.out に出力される。

  ? -e と -o に同じファイル名を指定するとどうなるのか
    両方ともそのファイルに出力されるが出力の順序は保たれない。
    但し、互いに上書きし合うという事は起こらない。
    これは何も指定しない場合の slurm-*.out や、
    -o だけ指定した時の出力先でも同様の振る舞いである。

  順序が保たれない事などを考えると自前でリダイレクトした方が良いかもしれない。
  或いは初めから out と err に別々のファイルを指定するという事。

  然し、異なる枠組みの上で動かしたいという事があるかもしれないので、
  この辺りは何れにしても自前で行う様にしておいた方が良い。
  標準エラーと標準出力を別々に保存するかあるいは一緒に保存するかは…
  一緒に保存する事にする。もし別々に保存する必要があるのであれば、
  それは submit する時にユーザの側で指定するべきなのである。

  →自前で redirect する様にしたがどうもそれでも標準出力と
    標準エーラ出力の順序が保たれない様である。
    bash が内部で勝手にバッファリングしているのか。
    或いは OS 自体の問題だろうか。然し OS は linux の筈である。不思議だ。


